function getTransaction(){doGet("api/transaction/all/"+$("#current_wallet").val(),a=>{if(!a.error)if(0==a.transaction.length)$("#transaction_list").html('<div class="center"><h4>No transactions. Tap <i class="fa fa-plus"></i> to add one</h4></div>');else{let b=0,c=0,d=$(".wallet_currency").html(),e="";a.transaction.forEach((a,f)=>{0==a.category.type?c+=Number(a.amount):b+=Number(a.amount);a.currency=d;e+=transactionView(a)}),$("#transaction_list").html(overview(b,c,d)+'<br>                    <br>                    <div class="row">                    <div class="list-view">                    '+e+"                    </div>                    </div>")}})}function updateWallet(){doGet("api/wallet/all",a=>{$("#wallet_list").html("");a.error||a.wallet.forEach((a,b)=>{$("#wallet_list").append('\t<div class="col s12 wallet" onclick="setCurrent('+a.id+", '"+a.name+'\');">        <div class="card-panel grey lighten-5 z-depth-1">          <div class="row valign-wrapper">            <div class="col s6">              <img src="img/wallet.png" alt="wallet" class="circle responsive-img">            </div>            <div class="col s10">              <span class="black-text">                <h5>'+a.name+"</h5>                <span>"+moneyFormat(a.balance)+" "+a.currency+"</span>              </span>            </div>          </div>        </div>      </div>");1==a.current&&($("#current_wallet").val(a.id),getTransaction(),$("#wallet_name").html(a.name),$("#wallet_balance").html(moneyFormat(a.balance)+' <span class="wallet_currency">'+a.currency+"</span>"),$("#add_transaction_wallet").val(a.name),$("#add_transaction_wallet_id").val(a.id),$(".wallet_currency").html(a.currency))})})}function setCurrent(a,b){setWallet?doGet("api/wallet/current/"+a,a=>{a.error||($("#wallet").modal("close"),updateWallet());noti(a.message)}):(addTransaction?($("#add_transaction_wallet").val(b),$("#add_transaction_wallet_id").val(a)):($("#update_transaction_wallet").val(b),$("#update_transaction_wallet_id").val(a)),$("#wallet").modal("close"))}function updateUserInfo(){let a=JSON.parse(get("userInfo"));$("#name").html('<i class="fa fa-user"></i> '+a.name),$("#my_account_email").val(a.email),$("#my_account_name").val(a.name)}function updateCC(){let a=JSON.parse(get("currency"));$("#currency_list").html(""),a.currency.forEach((a,b)=>{$("#currency_list").append('\t\t<div class="col s3 center currency" onclick="setCurrency({id:'+a.id+", name:'"+a.name+"', icon:'"+a.icon+'\'});">\t\t\t<img class="circle responsive-img" src="img/'+a.icon+'.png" alt="'+a.name+'"><br>\t\t\t<span>\t\t\t'+a.short+"\t\t\t</span>\t\t</div>\t\t")}),a=JSON.parse(get("category")),$("#catetgory_list_expense").html(""),$("#catetgory_list_income").html(""),a.category.forEach((a,b)=>{0==a.type?$("#category_list_expense").append('\t\t\t<div class="col s2 center category" onclick="setCategory({id:'+a.id+", name:'"+a.name+"', icon:'"+a.icon+'\'});">\t\t\t\t<img class="circle responsive-img" src="img/'+a.icon+'.png" alt="'+a.name+'"><br>\t\t\t\t<span>\t\t\t\t'+a.name+"\t\t\t\t</span>\t\t\t</div>\t\t\t"):$("#category_list_income").append('\t\t\t<div class="col s2 center category" onclick="setCategory({id:'+a.id+", name:'"+a.name+"', icon:'"+a.icon+'\'});">\t\t\t\t<img class="circle responsive-img" src="img/'+a.icon+'.png" alt="'+a.name+'"><br>\t\t\t\t<span>\t\t\t\t'+a.name+"\t\t\t\t</span>\t\t\t</div>\t\t\t")})}function setCategory(a){addTransaction?($("#add_transaction_category_id").val(a.id),$("#add_transaction_category").val(a.name),$("#add_transaction_category_icon").html("").removeClass("fa").removeClass("fa-dollar").append('<img class="circle responsive-img" src="img/'+a.icon+'.png">')):($("#update_transaction_category_id").val(a.id),$("#update_transaction_category").val(a.name),$("#update_transaction_category_icon").html("").removeClass("fa").removeClass("fa-dollar").append('<img class="circle responsive-img" src="img/'+a.icon+'.png">')),$("#category").modal("close")}function setCurrency(a){$("#add_wallet_currency_id").val(a.id),$("#add_wallet_currency").val(a.name),$("#currency_icon").html("").removeClass("fa").removeClass("fa-dollar").append('<img class="circle responsive-img" src="img/'+a.icon+'.png">'),$("#currency").modal("close")}function transactionView(a){let b,c;return 1==a.category.type?(b="status--online",c="blue-text"):(b="status--away",c="red-text"),'                <div class="list__item user '+b+' z-depth-3">        <div class="media media--user">        <div class="media__image">        <div class="image__overlay"></div>        <img src="img/'+a.category.icon+'.png" alt="user" class="img--avatar">        </div>        <div class="media__bd user__bd">        <i class="status-indicator "></i>        <br>        <div class="user-info row">        <div class="col s6">    <p class="user__name">'+a.note+'</p>    <p class="user__description">'+a.date+'</p>    </div>        <p class="user__name col s6 right-align '+c+'">'+a.amount+' <span class="wallet_currency">'+a.currency+'</span></p>    </div>    <div class="actions">        <a rel="nofollow" rel="noreferrer" href="#" onclick="updateTransaction(\''+a.id+"','"+a.amount+"','"+a.note+"','"+a.date+"','"+a.category.id+"','"+a.category.name+"','"+a.category.icon+"','"+a.wallet.id+"','"+a.wallet.name+'\')" class="action__item">        <svg style="width:24px;height:24px" viewBox="0 0 24 24">        <path fill="#000000" d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" />        </svg>        </div>        </a>        </div>        </div>        </div>'}function updateTransaction(a,b,c,d,e,f,g,h,i){$("#update_transaction_id").val(a),$("#update_transaction_amount").val(b),$("#update_transaction_note").val(c),$("#update_transaction_date").val(d),$("#update_transaction_category").val(f),$("#update_transaction_category_id").val(e),$("#update_transaction_category_icon > img").attr("src","img/"+g+".png"),$("#update_transaction_wallet").val(i),$("#update_transaction_wallet_id").val(h),$("#update_transaction").modal("open")}function overview(a,b,c){let d=Number(a-b);return'        <div class="row">        <div class="col m6 offset-m3 s12">        <div class="card white z-depth-3">        <div class="card-content white z-depth-3">        <span class="card-title">Overview</span><hr>        <p>        <div class="row">        <div class="col s8 left">Inflow: </div>    <div class="col s4 right-align blue-text">'+a+' <span class="wallet_currency">'+c+'</span></div>        </div>        </p>        <p>        <div class="row">        <div class="col s8 left">Outflow: </div>    <div class="col s4 right-align red-text">'+b+' <span class="wallet_currency">'+c+'</span></div>        </div>        </p>        <p>        <div class="row">        <div class="col s4 offset-s8 right-align '+(d<0?"red-text":"blue-text")+'"><hr>'+d+' <span class="wallet_currency">'+c+"</span></div>        </div>        </p>        </div>        </div>        </div>        </div>"}function logout(){remove("session"),remove("userInfo"),window.location.replace("./login")}function noti(a){Materialize.toast(a,4e3)}function doPost(a,b,c){$.ajax({url:a,headers:{Session:get("session"),"Content-Type":"application/json"},method:"POST",dataType:"json",data:JSON.stringify(b),success:a=>{c(a)}})}function doGet(a,b){$.ajax({url:a,headers:{Session:get("session")},method:"GET",success:a=>{b(a)}})}function set(a,b){return localStorage.setItem(a,b)}function get(a){return localStorage.getItem(a)}function remove(a){return localStorage.removeItem(a)}function moneyFormat(a){return a=a.toString(),a=""===a?"0.00":a.search("$")?parseFloat(a.replace(/[^\d\.-]/g,"")).formatMoney(2,".",","):parseFloat(a).formatMoney(2,".",",")}function unMoneyFormat(a){return Number(a.replace(/[^0-9.-]+/g,"")).toFixed(2)}let setWallet=!0,addTransaction=!1;$(document).ready(function(){get("session")||window.location.replace("./login"),$(".modal").modal(),$("#add_transaction").modal({ready:()=>{setWallet=!1;addTransaction=!0},complete:()=>{setWallet=!0;addTransaction=!1}}),$("#update_transaction").modal({ready:()=>{setWallet=!1},complete:()=>{setWallet=!0}}),$(".modal-addition").modal({dismissible:!1}),$(".datepicker").pickadate({container:"body",selectMonths:!0,selectYears:5,onSet:function(a){"select"in a&&this.close()}}),get("userInfo")?updateUserInfo():doGet("api/user/info",a=>{a.error?logout():(set("userInfo",JSON.stringify(a)),updateUserInfo())}),get("currency")||get("category")?updateCC():(doGet("api/currency/all",a=>{set("currency",JSON.stringify(a))}),doGet("api/category/all",a=>{set("category",JSON.stringify(a));updateCC()})),$("#my_account_button").on("click",()=>{if($("#my_account_new_password").val()!=$("#my_account_new_password_retype").val())noti("Mật khẩu nhập lại không đúng");else if($("#my_account_old_password").val()){let a={old_password:$("#my_account_old_password").val()};$("#my_account_name").val()&&(a.name=$("#my_account_name").val()),$("#my_account_new_password").val()&&(a.new_password=$("#my_account_new_password").val()),doPost("api/user/update",a,a=>{a.error||$("#my_account").modal("close");noti(a.message)}),$("#my_account_old_password").val(""),$("#my_account_new_password").val(""),$("#my_account_new_password_retype").val("")}}),$("#add_wallet_button").on("click",()=>{let a={name:$("#add_wallet_name").val(),currency:$("#add_wallet_currency_id").val(),startAmount:$("#add_wallet_startAmount").val()};a.name&&a.currency&&a.startAmount&&doPost("api/wallet/add",a,a=>{a.error||($("#add_wallet").modal("close"),$("#add_wallet_name").val(""),$("#add_wallet_currency").val(""),$("#add_wallet_startAmount").val(""),updateWallet());noti(a.message)})}),$("#add_transaction_button").on("click",()=>{let a={category:$("#add_transaction_category_id").val(),amount:$("#add_transaction_amount").val(),note:$("#add_transaction_note").val(),date:$("#add_transaction_date").val(),wallet:$("#add_transaction_wallet_id").val()};a.category&&a.amount&&a.date&&a.wallet&&a.note&&doPost("api/transaction/add",a,a=>{a.error||($("#add_transaction").modal("close"),$("#add_transaction_note").val(""),$("#add_transaction_amount").val(""),$("#add_transaction_date").val(""),$("#add_transaction_category").val(""));noti(a.message);getTransaction()})}),$("#update_transaction_button").on("click",()=>{let a={category:$("#update_transaction_category_id").val(),amount:$("#update_transaction_amount").val(),note:$("#update_transaction_note").val(),date:$("#update_transaction_date").val(),wallet:$("#update_transaction_wallet_id").val()};a.category&&a.amount&&a.date&&a.wallet&&a.note&&doPost("api/transaction/update/"+$("#update_transaction_id").val(),a,a=>{a.error||$("#update_transaction").modal("close");noti(a.message);getTransaction()})}),$("#update_transaction_delete").on("click",()=>{doGet("api/transaction/remove/"+$("#update_transaction_id").val(),a=>{a.error||$("#update_transaction").modal("close");noti(a.message);getTransaction()})}),updateWallet()}),Number.prototype.formatMoney=function(a,b,c){var d=this,a=isNaN(a=Math.abs(a))?2:a,b=void 0==b?",":b,c=void 0==c?".":c,e=d<0?"-":"",f=parseInt(d=Math.abs(+d||0).toFixed(a))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(a?b+Math.abs(d-f).toFixed(a).slice(2):"")};